<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Songs of Overcomers</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
    {% if login %}
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.3.2/socket.io.js"></script>
    <script type="text/javascript">
        var socket = io.connect('http://' + document.domain + ':' + location.port);

        function sendData(lyrics) {
            var dataToSend = lyrics; // Replace with your data source
            var user = "{{user}}"; // Replace with the user name or identifier

            socket.emit('send_data_event', { data: dataToSend, user: user });
        }

        socket.on('connect', function() {
            var user = "{{user}}"; // Replace with the user name or identifier
            socket.emit('join', user); // Join the room upon connection
            console.log('Connected and joined room:', user);
        });
    </script>
    {% endif %}

    <style>
        .nav-link {
            color: white;
        }

        .custom-search-button {
            background-color: white;
            width: 60px;
            height: 60px;
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            cursor: pointer;
            box-shadow: 0px 0px 5px rgba(0, 0, 0, 0.5);
        }

        .custom-search-button svg {
            width: 30px;
            height: 30px;
        }

        .fixed-button {
            position: fixed;
            bottom: 20px;
            right: 20px;
        }

        .custom-search-button:hover {
            background-color: #f0f0f0;
        }

        #loading-screen {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #212529;
            color: #fff;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        /* Style the loading image */
        #loading-image {
            width: 235px;
            height: 195px;
        }

        #online-status-card {
            display: none;
            position: fixed;
            top: 80px;
            left: 50%;
            transform: translate(-50%, 0);
            background-color: red;
            color: white;
            padding: 10px 20px;
            border-radius: 4px;
            width: 80%;
            text-align: center;
        }

        .status-close-button {
            float: right;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
        }

        .status-close-button:hover {
            color: white;
        }
    </style>
</head>

<body>
    <div id="loading-screen">
        <img id="loading-image" src="static/loader.gif" alt="Loading..." />
    </div>

    <nav class="navbar navbar-dark bg-dark sticky-top " aria-label="First navbar example" id="navbar"
        style="display: none;">
        <div class="container-fluid">
            <a class="navbar-brand" href="#"><img src="static/lightTransp.png" alt="oilnwine logo" width="35px"
                    height="35px" class="d-inline-block align-text-bottom"><span
                    style="font-size: 30px;color: bisque; font-family:cursive;"><b>&nbsp;Songs of
                        Overcomers</b></span></a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarpills"
                aria-controls="navbarpills" aria-expanded="false" aria-label="Toggle navigation"
                style="position:fixed; top: 15px; right:15px;">
                <span class="navbar-toggler-icon"></span>
            </button>

            <div class="collapse navbar-collapse" id="navbarpills">
                <br>
                <ul class="nav nav-pills mb-4 nav-fill" id="pills-tab" role="tablist">
                    <li class="nav-item" role="presentation">
                        <button class="nav-link active" id="all-tab" data-bs-toggle="pill" data-bs-target="#all"
                            type="button" role="tab" aria-controls="all" aria-selected="true">All Songs</button>
                    </li>
                    <li class="nav-item" role="presentation">
                        <button class="nav-link" id="english-tab" data-bs-toggle="pill" data-bs-target="#english"
                            type="button" role="tab" aria-controls="english" aria-selected="false">English</button>
                    </li>
                    <li class="nav-item" role="presentation">
                        <button class="nav-link" id="hindi-tab" data-bs-toggle="pill" data-bs-target="#hindi"
                            type="button" role="tab" aria-controls="hindi" aria-selected="false">Hindi</button>
                    </li>
                    <li class="nav-item" role="presentation">
                        <button class="nav-link" id="telugu-tab" data-bs-toggle="pill" data-bs-target="#telugu"
                            type="button" role="tab" aria-controls="telugu" aria-selected="false">Telugu</button>
                    </li>
                    <li class="nav-item" role="presentation">
                        <button class="nav-link" id="tamil-tab" data-bs-toggle="pill" data-bs-target="#tamil"
                            type="button" role="tab" aria-controls="tamil" aria-selected="false">Tamil</button>
                    </li>
                    <li class="nav-item" role="presentation">
                        <button class="nav-link" id="malayalam-tab" data-bs-toggle="pill" data-bs-target="#malayalam"
                            type="button" role="tab" aria-controls="malayalam" aria-selected="false">Malayalam</button>
                    </li>
                    <li class="nav-item" role="presentation">
                        <button class="nav-link" id="kannada-tab" data-bs-toggle="pill" data-bs-target="#kannada"
                            type="button" role="tab" aria-controls="kannada" aria-selected="false">Kannada</button>
                    </li>
                    <li class="nav-item" role="presentation">
                        <button class="nav-link" id="marathi-tab" data-bs-toggle="pill" data-bs-target="#marathi"
                            type="button" role="tab" aria-controls="marathi" aria-selected="false">Marathi</button>
                    </li>
                    <li class="nav-item" role="presentation">
                        <button class="nav-link" id="manipuri-tab" data-bs-toggle="pill" data-bs-target="#manipuri"
                            type="button" role="tab" aria-controls="manipuri" aria-selected="false">Manipuri</button>
                    </li>
                    <li class="nav-item" role="presentation">
                        <button class="nav-link" id="nagamese-tab" data-bs-toggle="pill" data-bs-target="#nagamese"
                            type="button" role="tab" aria-controls="nagamese" aria-selected="false">Nagamese</button>
                    </li>
                    {% if login %}
                    <li class="nav-item" role="presentation">
                        <button class="nav-link" id="settings-tab" data-bs-toggle="pill" data-bs-target="#settings"
                            type="button" role="tab" aria-controls="settings" aria-selected="false">Settings</button>
                    </li>
                    <li class="nav-item" role="presentation">
                        <button class="nav-link" id="add-tab" data-bs-toggle="pill" data-bs-target="#add" type="button"
                            role="tab" aria-controls="add" aria-selected="false">Add Songs</button>
                    </li>
                    <li class="nav-item" role="presentation">
                        <button class="nav-link" id="edit-tab" data-bs-toggle="pill" data-bs-target="#edit"
                            type="button" role="tab" aria-controls="edit" aria-selected="false">Edit Songs</button>
                    </li>
                    {% else %}
                    <li class="nav-item" role="presentation">
                        <button class="nav-link" id="login-tab" type="button"
                            onclick="location.href='/login'">LogIn</button>
                    </li>
                    {% endif %}
                </ul>
            </div>
        </div>
    </nav>

    <div class="container" id="searchicon" style="display: none;">
        <div class="fixed-button">
            <button type="button" class="custom-search-button" data-bs-toggle="modal" data-bs-target="#searchModal">
                <svg xmlns="http://www.w3.org/2000/svg" width="40" height="40" fill="currentColor" class="bi bi-search"
                    viewBox="0 0 16 16">
                    <path
                        d="M11.742 10.344a6.5 6.5 0 1 0-1.397 1.398h-.001c.03.04.062.078.098.115l3.85 3.85a1 1 0 0 0 1.415-1.414l-3.85-3.85a1.007 1.007 0 0 0-.115-.1zM12 6.5a5.5 5.5 0 1 1-11 0 5.5 5.5 0 0 1 11 0z" />
                </svg>
            </button>
        </div>
    </div>

    <!-- Modal for search -->
    <div class="modal fade" id="searchModal" tabindex="-1" aria-labelledby="searchModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="searchModalLabel">Search for Songs</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <input class="form-control me-2" type="search" placeholder="Search atleast 3 words sequence of song"
                        aria-label="Search" id="searchInput" oninput="clearSearchText(this)">
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" id="clear">Clear</button>
                    <button type="button" class="btn btn-primary" data-bs-dismiss="modal">Search</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal for Song -->
    <div class="modal fade" id="songModal" tabindex="-1" aria-labelledby="songModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered modal-dialog-scrollable">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="songModalLabel">Song Title</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body" id="songbody">
                    <center>
                        <div style="font-size: larger;" id="lyricsContainer"></div>
                    </center>
                </div>
                <div class="modal-footer">
                    <!-- <button type="button" class="btn btn-dark" style="position: absolute; left: 5px;"
                        onclick="listen()"><i class="fa fa-headphones" aria-hidden="true"></i> Listen</button> -->
                    {% if login %}
                    <!-- <button id="plus" type="button" class="btn btn-dark" onclick="increase()" style="position: absolute; left: 55px;"><i class="fa fa-plus" aria-hidden="true"></i></button>
                    
                    <button id="minus" type="button" class="btn btn-dark" onclick="decrease()" style="position: absolute; left: 5px;"><i class="fa fa-minus" aria-hidden="true"></i></button> -->
                    <button id="send" type="button" class="btn btn-dark" onclick="sendControl()"
                        style="position: absolute; left: 5px;"><i class="fa fa-send" aria-hidden="true"></i></button>
                    {% endif %}
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                    <button type="button" class="btn btn-primary" onclick="location.href='/'">Home Page</button>
                </div>
            </div>
        </div>
    </div>

    <br>

    <div class="tab-content" id="pills-tabContent">

        <div class="tab-pane fade show active" id="all" role="tabpanel" aria-labelledby="all-tab">

            <center>
                <table class="table table-dark table-hover table-bordered" style="margin-top: -25px;">
                    <thead class="table-dark">
                        <tr>
                            <th style="display: none;">Id</th>
                            <th style="width:20%">
                                <center style="font-size: 20px;color: bisque; font-family:cursive;">Song No</center>
                            </th>
                            <th>
                                <center style="font-size: 20px;color: bisque; font-family:cursive;">Song Title</center>
                            </th>
                            <!-- <th style="display: none;">Alternate Title</th>
                            <th style="display: none;">Search Title</th>
                            <th style="display: none;">Search Lyrics</th> -->
                            <!-- Add more column headings as per your database structure -->
                        </tr>
                    </thead>
                    <tbody class="table-primary" id="songTable">
                        {% for row in rows %}
                        <tr data-id="{{ row[0] }}">
                            <td>{{ row[1] }}</td>
                            <td data-bs-toggle="modal" data-bs-target="#songModal">{{ row[2] }}</td>

                            <td style="display: none;">{{ row[3] }}</td>
                            <td style="display: none;">{{ row[4] }}</td>
                            <!-- Add more columns as per your database structure -->
                        </tr>
                        {% endfor %}
                    </tbody>
                </table><br><br>
            </center>
        </div>
        <div class="tab-pane fade" id="english" role="tabpanel" aria-labelledby="english-tab">
            <h1>
                <br><br><br><br><br><br>
                <center>Coming Soon!</center>
            </h1>
        </div>
        <div class="tab-pane fade" id="hindi" role="tabpanel" aria-labelledby="hindi-tab">
            <h1>
                <br><br><br><br><br><br>
                <center>Coming Soon!</center>
            </h1>
        </div>
        <div class="tab-pane fade" id="telugu" role="tabpanel" aria-labelledby="telugu-tab">
            <h1>
                <br><br><br><br><br><br>
                <center>Coming Soon!</center>
            </h1>
        </div>
        <div class="tab-pane fade" id="tamil" role="tabpanel" aria-labelledby="tamil-tab">
            <h1>
                <br><br><br><br><br><br>
                <center>Coming Soon!</center>
            </h1>
        </div>
        <div class="tab-pane fade" id="malayalam" role="tabpanel" aria-labelledby="malayalam-tab">
            <h1>
                <br><br><br><br><br><br>
                <center>Coming Soon!</center>
            </h1>
        </div>
        <div class="tab-pane fade" id="kannada" role="tabpanel" aria-labelledby="kannada-tab">
            <h1>
                <br><br><br><br><br><br>
                <center>Coming Soon!</center>
            </h1>
        </div>
        <div class="tab-pane fade" id="marathi" role="tabpanel" aria-labelledby="marathi-tab">
            <h1>
                <br><br><br><br><br><br>
                <center>Coming Soon!</center>
            </h1>
        </div>
        <div class="tab-pane fade" id="manipuri" role="tabpanel" aria-labelledby="manipuri-tab">
            <h1>
                <br><br><br><br><br><br>
                <center>Coming Soon!</center>
            </h1>
        </div>
        <div class="tab-pane fade" id="nagamese" role="tabpanel" aria-labelledby="nagamese-tab">
            <h1>
                <br><br><br><br><br><br>
                <center>Coming Soon!</center>
            </h1>
        </div>
        <div class="tab-pane fade" id="settings" role="tabpanel" aria-labelledby="settings-tab">
            <h1>
                <br><br><br><br>
                <!-- <center><button  class="btn btn-primary">Font Decrease</button>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<button  class="btn btn-primary">Font Increase</button></center><br><br> -->
                <center><button onclick="location.href='/logout'" class="btn btn-primary">LogOut</button></center>
            </h1>
        </div>
        <div class="tab-pane fade" id="edit" role="tabpanel" aria-labelledby="edit-tab">
            <h1>
                <br><br><br><br><br><br>
                <center>Coming Soon!</center>
            </h1>
        </div>
    </div>




    <script>


        document.addEventListener("DOMContentLoaded", function () {
            // Page has fully loaded, so remove the loading screen
            document.body.classList.add("loaded");
            document.querySelector("#loading-screen").style.display = "none";
            document.querySelector("#navbar").style.display = "block";
            document.querySelector("#searchicon").style.display = "block";

        });


        // Select the search input element and rows

        const input = document.querySelector('#searchInput');
        const clear = document.querySelector('#clear');
        const rows = document.querySelectorAll('#songTable tr');

        clear.addEventListener('click', function () {
            input.value = '';
            performSearch(input.value.toLowerCase());
        });

        // Add an event listener to the search input field for real-time search
        input.addEventListener('input', function () {
            performSearch(input.value.toLowerCase());
        });

        function performSearch(searchText) {
            for (let i = 0; i < rows.length; i++) {
                const row = rows[i];
                const cells = row.getElementsByTagName('td');
                let found = false;
                for (let j = 0; j < cells.length; j++) {
                    const cell = cells[j];
                    if (cell) {
                        const text = cell.textContent.toLowerCase();
                        if (text.includes(searchText)) {
                            found = true;
                            break;
                        }
                    }
                }
                if (found) {
                    row.style.display = '';
                } else {
                    row.style.display = 'none';
                }
            }
        }

        const songModalTitle = document.getElementById('songModalLabel');
        const songModalBody = document.getElementById('songbody');

        var lyrics = "";

        function sendControl() {
            sendData(lyrics);
        }

        // Add a click event listener to each row
        rows.forEach(row => {
            row.addEventListener('click', () => {
                const selectedId = row.getAttribute('data-id');
                fetch('/get_lyrics', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ id: selectedId }),
                })
                    .then(response => response.json())
                    .then(data => {
                        lyrics = data.lyrics; // Assuming data.lyrics contains the received lyrics
                        console.log(lyrics);
                        const title = data.title;
                        updateLyrics(lyrics);
                        songModalTitle.textContent = title;
                    })
                    .catch(error => {
                        console.error('Error:', error);
                    });
            });
        });
        let selectedParagraph = null;

        var font_size = 500;

        function increase() {
            font_size = font_size + 20;

        }

        function decrease() {
            font_size = font_size - 20;

        }

        function updateLyrics(lyrics) {
            const lyricsContainer = document.getElementById('lyricsContainer');
            lyricsContainer.innerHTML = lyrics; // Clear previous content
        }

    </script>

    {% if login %}

    <script>

        function sendData2(lyrics) {
            var dataToSend = lyrics; // Replace with your data source
            var user = "{{user}}_display"; // Replace with the user name or identifier

            socket.emit('send_para', { data: dataToSend, user: user });
        }

        socket.on('connect', function () {
            var user = "{{user}}_display"; // Replace with the user name or identifier
            socket.emit('join', user); // Join the room upon connection
            console.log('Connected and joined display room:', user);
        });

        // Function to convert <br> tags to newline characters
        function convertBRtoNewline(text) {
            return text.replace(/<br\s*\/?>/gi, '\n');
        }

        // Function to be executed when a <p> tag is clicked
        function handleClick(event) {
            // Get the clicked element
            const clickedElement = event.target;

            // Check if the clicked element is a <p> tag
            if (clickedElement.tagName === 'P') {
                // Get the text content of the clicked <p> tag
                const clickedText = clickedElement.innerHTML;

                // Convert <br> tags to newlines for the clicked paragraph
                const textWithNewlines = convertBRtoNewline(clickedText);

                // Now textWithNewlines contains the text content with newline characters
                console.log(textWithNewlines);

                sendData2(textWithNewlines);
                // Perform other actions with the modified text content as needed
            }
        }

        // Event delegation: Listen for click events on the document
        document.addEventListener('click', function (event) {
            // Check if the clicked element or any of its ancestors is a <p> tag
            const isParagraph = event.target.closest('p');

            // If a <p> tag or its descendant is clicked, handle the click
            if (isParagraph) {
                handleClick(event);
            }
        });

    </script>

    {% endif %}



    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM"
        crossorigin="anonymous"></script>
</body>

</html>